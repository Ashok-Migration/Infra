trigger:
  batch: true
  branches:
    include:
      - master

  paths:
    include:
      - marketplace/news/projects/tasmu-news/package.json
      - marketplace/aboutTasmu/projects/tasmu-about/package.json
      - marketplace/productAndService/projects/products-and-services/package.json
      - marketplace/support/projects/tasmu-support/package.json
      - marketplace/my-account/projects/tasmu-myaccount/package.json
      - marketplace/common-ui/projects/tasmu-common-ui/package.json

variables:
  poolName: "tasmumsagents"
  feedURL: "d0902a05-fe88-4eb4-bab4-badafc58ebfa/f333d4e3-324a-45e6-9c13-ccc90b82eac4"

pool:
  name: $(poolName)

jobs:
  - job: Get_Build_Queue
    steps:
      - checkout: web-apps
        clean: true 
        path: TASMU Central Platform/web-apps
        
      - task: PowerShell@2
        name: setBuildQueue
        inputs:
          targetType: filePath
          filePath: "pipelines/build/templates/get-publishchange-queue.ps1"
        displayName: "Get Service Build Queue"

  - template: templates/build-publish-apps.yml
    parameters:
      name: productAndService
      workingDirectory: "marketplace/productAndService"
      publishProject: "products-and-services"

  - template: templates/build-publish-apps.yml
    parameters:
      name: support
      workingDirectory: "marketplace/support"
      publishProject: "tasmu-support"
  
  - template: templates/build-publish-apps.yml
    parameters:
      name: news
      workingDirectory: "marketplace/news"
      publishProject: "tasmu-news"

  - template: templates/build-publish-apps.yml
    parameters:
      name: about
      workingDirectory: "marketplace/aboutTasmu"
      publishProject: "tasmu-about"    

  - template: templates/build-publish-apps.yml
    parameters:
      name: myaccount
      workingDirectory: "marketplace/my-account"
      publishProject: "tasmu-myaccount"  

  - template: templates/build-publish-apps.yml
    parameters:
      name: commonui
      workingDirectory: "marketplace/common-ui"
      publishProject: "tasmu-common-ui"
